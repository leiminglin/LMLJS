/**
 * LMLJS Framework
 * Copyright (c) 2014 http://lmlphp.com All rights reserved.
 * Licensed ( http://mit-license.org/ )
 * Author: leiminglin <leiminglin@126.com>
 *
 * A lovely javascript framework.
 *
 * $id: $
 *
 */
!function(e,t,n){function a(){function n(n,a,r,o){r=t.createElement("script"),o=t.getElementsByTagName("script")[0],r.async=1,r.src=n;try{o.parentNode.insertBefore(r,o),e.addEventListener?r.addEventListener("load",a,!1):e.attachEvent?r.onreadystatechange=function(){this.readyState.match(/loaded|complete/i)&&a()}:r.onload=function(){a()}}catch(i){a()}}function a(e,t,n){function a(){var i=e.shift(),s=e.shift();e.unshift(s),r(i,function(){s?(a(),o[s].callback.running||r.start(s)):t()},n)}e[0];a()}function r(e,t,c){if("object"==typeof e&&e instanceof Array)return a(e,t);t=t||function(){s.promise()};var l=function(){c=c+""=="1"?!0:!1;var a=function(){n(e,function(){o[e].loaded=!0,t(),r.start(e)})};c?a():o[e].start||o[e].loaded?(t(),r.start(e)):a(),o[e].start=!0};if(o[e])o[e].callback.then(l);else{var f=i();f.then(l),o[e]={loaded:!1,start:!1,callback:f}}o[e].callback.running||r.start(e)}var o={};return r.competeLoad=function(e,t,n){for(var a=0,o=e.length;o>a;a++)r(e.shift(),function(){this.flag||(t(),this.flag=1)})},r.start=function(e){if(f.onload)if(e)o[e].callback.promise();else for(var t in o)o[t].callback.promise()},r}function r(n){var a=n.offsetTop,r=n.offsetParent;if(null==r&&n.parentNode)for(var o=n.parentNode;null==r&&(r=o.offsetParent,o=o.parentNode););for(;null!==r;)a+=r.offsetTop+r.clientTop,r=r.offsetParent;var i;return"number"==typeof e.pageYOffset?i=e.pageYOffset:(docElement=t.compatMode&&"CSS1Compat"===t.compatMode?t.documentElement:t.body,i=docElement.scrollTop),a-i}function o(){return t.compatMode&&"BackCompat"==t.compatMode&&t.body?{width:t.body.clientWidth,height:t.body.clientHeight}:{width:t.documentElement.clientWidth,height:t.documentElement.clientHeight}}var i=function(){var e={};return e.queue=[],e.running=!1,e.promise=function(){e.queue.length?(e.running=!0,e.queue.shift()()):e.running=!1},e.then=function(t){e.queue.push(t)},e},s=i(),c=a();s.then(function(){var n,a,i=t.getElementsByTagName("IMG"),c=o(),l=0;e.onresize=function(){c=o()};var f=function(){if(l>=i.length)return void(e.addEventListener?t.removeEventListener("scroll",f,!1):e.attachEvent&&e.detachEvent(event,f));for(n=0,j=i.length;n<j;n++)if(!i[n].getAttribute("src")){var o=r(i[n]),s=i[n].getAttribute("height")||0;o>=-s&&o<c.height&&(a=i[n].getAttribute("osrc"))&&(i[n].setAttribute("src",a),i[n].onerror=function(){(a=this.getAttribute("osrc-bak"))&&(this.setAttribute("src",a),this.onerror=null)},i[n].onload=function(){l++})}};e.addEventListener?t.addEventListener("scroll",f,!1):e.attachEvent&&e.attachEvent("onscroll",f),f(),s.promise()}),"function"!=typeof t.getElementsByClassName&&(t.getElementsByClassName=function(e){for(var n=t,a=n.getElementsByTagName("*"),r=new RegExp("\\b"+e+"\\b"),o=[],i=0,s=a.length;s>i;i++){var e=a[i].className;r.test(e)&&o.push(a[i])}return o});var l=function(e){var n=t.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(n)};s.then(function(){for(var e=t.getElementsByClassName("lazyCss"),n=0;n<e.length;n++)l(e[n].value||e[n].innerHTML);s.promise()}),s.then(function(){for(var e=t.getElementsByClassName("lazyHtml"),n=0;n<e.length;n++)if("TEXTAREA"==e[n].tagName){var a=t.createElement("DIV");a.innerHTML=e[n].value,e[n].parentNode.insertBefore(a,e[n])}s.promise()});var f={};f.deferred=s,f.createDeferred=i,f.loadJs=c,f.onload=!1,f.run=function(){f.onload=!0,s.promise(),c.start()},e.lml=f}(window,document);
