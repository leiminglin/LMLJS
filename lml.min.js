/**
 * LMLJS Framework
 * Copyright (c) 2014 http://lmlphp.com All rights reserved.
 * Licensed ( http://mit-license.org/ )
 * Author: leiminglin <leiminglin@126.com>
 *
 * A lovely javascript framework.
 *
 * $id: $
 *
 */
!function(e,t,n){function o(e){return e={},e.queue=[],e.running=0,e.promise=function(){e.queue.length?(e.running=1,e.queue.shift()()):e.running=0},e.then=function(t){e.queue.push(t)},e}function a(n){function a(n,o,a,r){a=t.createElement("script"),r=t.getElementsByTagName("script")[0],a.async=1,a.src=n;try{r.parentNode.insertBefore(a,r),e.addEventListener?a.addEventListener("load",o,!1):e.attachEvent?a.onreadystatechange=function(){this.readyState.match(/loaded|complete/i)&&o()}:a.onload=function(){o()}}catch(i){o()}}function r(e,t,o,a){function r(a,c){a=e.shift(),c=e.shift(),e.unshift(c),i(a,function(){c?(r(),n[c].callback.running||i.start(c)):t()},o)}a=e[0],r()}function i(e,t,c,l){function f(){function o(){a(e,function(){n[e].loaded=1,t(),i.start(e)})}c=c+""=="1"?1:0,c?o():n[e].start||n[e].loaded?(t(),i.start(e)):o(),n[e].start=1}return"object"==typeof e&&e instanceof Array?r(e,t):(t=t||function(){s.promise()},n[e]?n[e].callback.then(f):(l=o(),l.then(f),n[e]={loaded:0,start:0,callback:l}),void(n[e].callback.running||i.start(e)))}return n={},i.competeLoad=function(e,t,n,o,a){for(o=0,a=e.length;a>o;o++)i(e.shift(),function(){this.flag||(t(),this.flag=1)})},i.start=function(e,t){if(f.onload)if(e)n[e].callback.promise();else for(t in n)n[t].callback.promise()},i}function r(n){var o,a,r=n.offsetTop,i=n.offsetParent;if(null==i&&n.parentNode)for(o=n.parentNode;null==i&&(i=o.offsetParent,o=o.parentNode););for(;null!==i;)r+=i.offsetTop+i.clientTop,i=i.offsetParent;return"number"==typeof e.pageYOffset?a=e.pageYOffset:(docElement=t.compatMode&&"CSS1Compat"===t.compatMode?t.documentElement:t.body,a=docElement.scrollTop),r-a}function i(){return t.compatMode&&"BackCompat"==t.compatMode&&t.body?{width:t.body.clientWidth,height:t.body.clientHeight}:{width:t.documentElement.clientWidth,height:t.documentElement.clientHeight}}function c(e,n){n=t.createElement("style"),n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(n)}var s=o(),l=a(),f={};s.then(function(){function n(){if(d>=f.length)return void(e.addEventListener?t.removeEventListener("scroll",n,!1):e.attachEvent&&e.detachEvent(event,n));for(o=0,j=f.length;o<j;o++)f[o].getAttribute("src")||(c=r(f[o]),l=f[o].getAttribute("height")||0,c>=-l&&c<u.height&&(a=f[o].getAttribute("osrc"))&&(f[o].setAttribute("src",a),f[o].onerror=function(){(a=this.getAttribute("osrc-bak"))&&(this.setAttribute("src",a),this.onerror=null)},f[o].onload=function(){d++}))}var o,a,c,l,f=t.getElementsByTagName("IMG"),u=i(),d=0;e.onresize=function(){u=i()},e.addEventListener?t.addEventListener("scroll",n,!1):e.attachEvent&&e.attachEvent("onscroll",n),n(),s.promise()}),"function"!=typeof t.getElementsByClassName&&(t.getElementsByClassName=function(e){var n,o,e,a=t.getElementsByTagName("*"),r=new RegExp("\\b"+e+"\\b"),i=[];for(n=0,o=a.length;o>n;n++)e=a[n].className,r.test(e)&&i.push(a[n]);return i}),s.then(function(e,n){for(e=t.getElementsByClassName("lazyCss"),n=0;n<e.length;n++)c(e[n].value||e[n].innerHTML);s.promise()}),s.then(function(){var e,n,o=t.getElementsByClassName("lazyHtml");for(e=0;e<o.length;e++)"TEXTAREA"==o[e].tagName&&(n=t.createElement("DIV"),n.innerHTML=o[e].value,o[e].parentNode.insertBefore(n,o[e]));s.promise()}),f.deferred=s,f.createDeferred=o,f.loadJs=l,f.onload=0,f.run=function(){f.onload=1,s.promise(),l.start()},e.lml=f}(window,document);
