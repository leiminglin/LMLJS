/**
 * LMLJS Framework
 * Copyright (c) 2014 http://lmlphp.com All rights reserved.
 * Licensed ( http://mit-license.org/ )
 * Author: leiminglin <leiminglin@126.com>
 *
 * A lovely javascript framework.
 *
 * $id: $
 *
 */
!function(h,g){function r(t){return t={queue:[],running:0,promise:function(){t.queue.length?(t.running=1,t.queue.shift()()):t.running=0},then:function(e){t.queue.push(e)},front:function(e){t.queue.unshift(e)}}}var i,t,p=r(),e=(i={},s.competeLoad=function(e,t,n,o,a,r){for(a=0,r=e.length;a<r;a++)s(e.shift(),function(){return t.flag?n():(t(),void(t.flag=1))},o)},s.start=function(e,t){if(v.onload)if(e)i[e].callback.promise();else for(t in i)i[t].callback.promise()},s),v={};function c(o,a,r){o[0],function e(t,n){t=o.shift(),n=o.shift(),o.unshift(n),s(t,function(){n?(e(),i[n].callback.running||s.start(n)):a()},r)}()}function s(t,n,o,e){if("object"==typeof t&&t instanceof Array)return c(t,n);function a(){function e(){!function(e,t,n,o){n=g.createElement("script"),o=g.getElementsByTagName("script")[0],n.async=1,n.src=e;try{o.parentNode.insertBefore(n,o),h.addEventListener?n.addEventListener("load",t,!1):h.attachEvent?n.onreadystatechange=function(){this.readyState.match(/loaded|complete/i)&&t()}:n.onload=function(){t()}}catch(e){t()}}(t,function(){i[t].loaded=1,n(),s.start(t)})}!(o=o+""=="1"?1:0)&&(i[t].start||i[t].loaded)?(n(),s.start(t)):e(),i[t].start=1}n=n||function(){p.promise()},i[t]?i[t].callback.then(a):((e=r()).then(a),i[t]={loaded:0,start:0,callback:e}),i[t].callback.running||s.start(t)}function E(){return g.compatMode&&"BackCompat"==g.compatMode&&g.body?{width:g.body.clientWidth,height:g.body.clientHeight}:{width:g.documentElement.clientWidth,height:g.documentElement.clientHeight}}v.registerOnResize=(t=[],function(e){t.push(e),h.onresize=function(){for(var e in t)t[e]()}}),p.then(function(){var e,t,n,o,a,r=g.getElementsByTagName("IMG"),i=E(),c=0;v.registerOnResize(function(){i=E()});var s,l=[];function f(){clearTimeout(o),o=setTimeout(function(){if(c>=r.length)h.addEventListener?g.removeEventListener("scroll",f,!1):h.attachEvent&&h.detachEvent(event,f);else for(l=[],e=0,j=r.length;e<j;e++)r[e].getAttribute("src")||(n=function(e){var t,n=e.offsetTop,o=e.offsetParent;if(null==o&&e.parentNode)for(t=e.parentNode;null==o&&(o=t.offsetParent,t=t.parentNode););for(;o;)n+=o.offsetTop+o.clientTop,o=o.offsetParent;return n-("number"==typeof h.pageYOffset?h.pageYOffset:(docElement=g.compatMode&&"CSS1Compat"===g.compatMode?g.documentElement:g.body,docElement.scrollTop))}(r[e]),-(r[e].getAttribute("height")||0)<=n&&n<i.height&&(t=r[e].getAttribute("osrc"))&&(l.push(r[e]),r[e].onerror=function(){(t=this.getAttribute("osrc-bak"))&&(this.setAttribute("src",t),this.onerror=null)},r[e].onload=function(){c++}))},9)}var u=function(){clearTimeout(a),a=setTimeout(function(){var e,t=l.shift();t?(t.setAttribute("src",t.getAttribute("osrc")),e=0,s=setInterval(function(){return e+=9,t.complete||e>(v.config.imgDelay||500)?(clearInterval(s),u()):void 0},9)):u()},9)};u(),h.addEventListener?g.addEventListener("scroll",f,!1):h.attachEvent&&h.attachEvent("onscroll",f),f();var d=1,m=function(){f(),1e3<(d*=2)&&(d=1e3),setTimeout(m,d)};setTimeout(m,d),p.promise()}),"function"!=typeof g.getElementsByClassName&&(g.getElementsByClassName=function(e){for(var t=g.getElementsByTagName("*"),n=new RegExp("\\b"+e+"\\b"),o=[],a=0,r=t.length;a<r;a++)e=t[a].className,n.test(e)&&o.push(t[a]);return o}),p.then(function(e,t){for(e=g.getElementsByClassName("lazyCss"),t=0;t<e.length;t++)n=e[t].value||e[t].innerHTML,o=void 0,(o=g.createElement("style")).type="text/css",o.styleSheet?o.styleSheet.cssText=n:o.innerHTML=n,g.getElementsByTagName("head")[0].appendChild(o);var n,o;p.promise()}),p.then(function(){for(var e,t=g.getElementsByClassName("lazyHtml"),n=0;n<t.length;n++)"TEXTAREA"==t[n].tagName&&((e=g.createElement("DIV")).innerHTML=t[n].value,t[n].parentNode.insertBefore(e,t[n]));p.promise()}),v.config=function(e){for(var t in e)v.config[t]=e[t]};var n=function(){};"function"==typeof h.onload&&(n=h.onload),v.deferred=p,v.createDeferred=r,v.loadJs=e,v.loadCss=function(e,t,n,o){n=g.createElement("link"),o=g.getElementsByTagName("script")[0],t=t||function(){},n.rel="stylesheet",n.type="text/css",n.href=e;try{o.parentNode.insertBefore(n,o),h.addEventListener?n.addEventListener("load",t,!1):h.attachEvent?n.onreadystatechange=function(){this.readyState.match(/loaded|complete/i)&&t()}:n.onload=function(){t()}}catch(e){t()}},v.onload=0,v.run=function(){v.onload||(v.onload=1,p.promise(),e.start(),n())},h.lml=v,h.onload=v.run}(window,document);
