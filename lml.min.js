/**
 * LMLJS Framework
 * Copyright (c) 2014 http://lmlphp.com All rights reserved.
 * Licensed ( http://mit-license.org/ )
 * Author: leiminglin <leiminglin@126.com>
 *
 * A lovely javascript framework.
 *
 * $id: $
 *
 */
!function(m,h){function r(t){return t={queue:[],running:0,promise:function(){t.queue.length?(t.running=1,t.queue.shift()()):t.running=0},then:function(e){t.queue.push(e)},front:function(e){t.queue.unshift(e)}}}var i,t,g=r(),e=(i={},s.competeLoad=function(e,t,n,o,a,r){for(a=0,r=e.length;a<r;a++)s(e.shift(),function(){return t.flag?n():(t(),void(t.flag=1))},o)},s.start=function(e,t){if(p.onload)if(e)i[e].callback.promise();else for(t in i)i[t].callback.promise()},s),p={};function c(o,a,r){o[0],function e(t,n){t=o.shift(),n=o.shift(),o.unshift(n),s(t,function(){n?(e(),i[n].callback.running||s.start(n)):a()},r)}()}function s(t,n,o,e){if("object"==typeof t&&t instanceof Array)return c(t,n);function a(){function e(){!function(e,t,n,o){n=h.createElement("script"),o=h.getElementsByTagName("script")[0],n.async=1,n.src=e;try{o.parentNode.insertBefore(n,o),m.addEventListener?n.addEventListener("load",t,!1):m.attachEvent?n.onreadystatechange=function(){this.readyState.match(/loaded|complete/i)&&t()}:n.onload=function(){t()}}catch(e){t()}}(t,function(){i[t].loaded=1,n(),s.start(t)})}!(o=o+""=="1"?1:0)&&(i[t].start||i[t].loaded)?(n(),s.start(t)):e(),i[t].start=1}n=n||function(){g.promise()},i[t]?i[t].callback.then(a):((e=r()).then(a),i[t]={loaded:0,start:0,callback:e}),i[t].callback.running||s.start(t)}function E(){return h.compatMode&&"BackCompat"==h.compatMode&&h.body?{width:h.body.clientWidth,height:h.body.clientHeight}:{width:h.documentElement.clientWidth,height:h.documentElement.clientHeight}}p.registerOnResize=(t=[],function(e){t.push(e),m.onresize=function(){for(var e in t)t[e]()}}),g.then(function(){var e,t,n,o,a,r=h.getElementsByTagName("IMG"),i=E(),c=0;p.registerOnResize(function(){i=E()});var s=[];function l(){clearTimeout(o),clearTimeout(a),o=setTimeout(function(){if(c>=r.length)m.addEventListener?h.removeEventListener("scroll",l,!1):m.attachEvent&&m.detachEvent(event,l);else{for(s=[],e=0,j=r.length;e<j;e++)r[e].getAttribute("src")||(n=function(e){var t,n=e.offsetTop,o=e.offsetParent;if(null==o&&e.parentNode)for(t=e.parentNode;null==o&&(o=t.offsetParent,t=t.parentNode););for(;o;)n+=o.offsetTop+o.clientTop,o=o.offsetParent;return n-("number"==typeof m.pageYOffset?m.pageYOffset:(docElement=h.compatMode&&"CSS1Compat"===h.compatMode?h.documentElement:h.body,docElement.scrollTop))}(r[e]),-(r[e].getAttribute("height")||0)<=n&&n<i.height&&(t=r[e].getAttribute("osrc"))&&(s.push(r[e]),r[e].onerror=function(){(t=this.getAttribute("osrc-bak"))&&(this.setAttribute("src",t),this.onerror=null)},r[e].onload=function(){c++}));f()}},9)}var f=function(){a=setTimeout(function(){var e=s.shift();e&&(e.setAttribute("src",e.getAttribute("osrc")),f())},p.config.imgDelay||250)};m.addEventListener?h.addEventListener("scroll",l,!1):m.attachEvent&&m.attachEvent("onscroll",l),l();var u=1,d=function(){l(),1e3<(u*=2)&&(u=1e3),setTimeout(d,u)};setTimeout(d,u),g.promise()}),"function"!=typeof h.getElementsByClassName&&(h.getElementsByClassName=function(e){for(var t=h.getElementsByTagName("*"),n=new RegExp("\\b"+e+"\\b"),o=[],a=0,r=t.length;a<r;a++)e=t[a].className,n.test(e)&&o.push(t[a]);return o}),g.then(function(e,t){for(e=h.getElementsByClassName("lazyCss"),t=0;t<e.length;t++)n=e[t].value||e[t].innerHTML,o=void 0,(o=h.createElement("style")).type="text/css",o.styleSheet?o.styleSheet.cssText=n:o.innerHTML=n,h.getElementsByTagName("head")[0].appendChild(o);var n,o;g.promise()}),g.then(function(){for(var e,t=h.getElementsByClassName("lazyHtml"),n=0;n<t.length;n++)"TEXTAREA"==t[n].tagName&&((e=h.createElement("DIV")).innerHTML=t[n].value,t[n].parentNode.insertBefore(e,t[n]));g.promise()}),p.config=function(e){for(var t in e)p.config[t]=e[t]};var n=function(){};"function"==typeof m.onload&&(n=m.onload),p.deferred=g,p.createDeferred=r,p.loadJs=e,p.loadCss=function(e,t,n,o){n=h.createElement("link"),o=h.getElementsByTagName("script")[0],t=t||function(){},n.rel="stylesheet",n.type="text/css",n.href=e;try{o.parentNode.insertBefore(n,o),m.addEventListener?n.addEventListener("load",t,!1):m.attachEvent?n.onreadystatechange=function(){this.readyState.match(/loaded|complete/i)&&t()}:n.onload=function(){t()}}catch(e){t()}},p.onload=0,p.run=function(){p.onload||(p.onload=1,g.promise(),e.start(),n())},m.lml=p,m.onload=p.run}(window,document);
