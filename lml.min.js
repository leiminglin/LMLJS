/**
 * LMLJS Framework
 * Copyright (c) 2014 http://lmlphp.com All rights reserved.
 * Licensed ( http://mit-license.org/ )
 * Author: leiminglin <leiminglin@126.com>
 *
 * A lovely javascript framework.
 *
 * $id: $
 *
 */
!function(e,t,n){function o(){function e(e,n,o,r){o=t.createElement("script"),r=t.getElementsByTagName("script")[0],o.async=1,o.src=e;try{r.parentNode.insertBefore(o,r),window.addEventListener?o.addEventListener("load",n,!1):window.attachEvent?o.onreadystatechange=function(){this.readyState.match(/loaded|complete/i)&&n()}:o.onload=function(){n()}}catch(a){n()}}function n(e,t,n){function a(){var i=e.shift(),s=e.shift();e.unshift(s),o(i,function(){s?(a(),r[s].callback.running||o.start(s)):t()},n)}e[0];a()}function o(t,a,c){if("object"==typeof t&&t instanceof Array)return n(t,a);a=a||function(){s.promise()};var l=function(){c=c+""=="1"?!0:!1;var n=function(){e(t,function(){r[t].loaded=!0,a(),o.start(t)})};c?n():r[t].start||r[t].loaded?(a(),o.start(t)):n(),r[t].start=!0};if(r[t])r[t].callback.then(l);else{var f=i();f.then(l),r[t]={loaded:!1,start:!1,callback:f}}r[t].callback.running||o.start(t)}var r={};return o.start=function(e){if(f.onload)if(e)r[e].callback.promise();else for(var t in r)r[t].callback.promise()},o}function r(n){var o=n.offsetTop,r=n.offsetParent;if(null==r&&n.parentNode)for(var a=n.parentNode;null==r&&(r=a.offsetParent,a=a.parentNode););for(;null!==r;)o+=r.offsetTop+r.clientTop,r=r.offsetParent;var i;return"number"==typeof e.pageYOffset?i=e.pageYOffset:(docElement=t.compatMode&&"CSS1Compat"===t.compatMode?t.documentElement:t.body,i=docElement.scrollTop),o-i}function a(){return t.compatMode&&"BackCompat"==t.compatMode&&t.body?{width:t.body.clientWidth,height:t.body.clientHeight}:{width:t.documentElement.clientWidth,height:t.documentElement.clientHeight}}var i=function(){var e={};return e.queue=[],e.running=!1,e.promise=function(){e.queue.length?(e.running=!0,e.queue.shift()()):e.running=!1},e.then=function(t){e.queue.push(t)},e},s=i(),c=o();s.then(function(){var e,n,o=t.getElementsByTagName("IMG"),i=a(),c=0;window.onresize=function(){i=a()};var l=function(){if(c>=o.length)return void(window.addEventListener?t.removeEventListener("scroll",l,!1):window.attachEvent&&window.detachEvent(event,l));for(e=0,j=o.length;e<j;e++)if(!o[e].getAttribute("src")){var a=r(o[e]),s=o[e].getAttribute("height")||0;a>=-s&&a<i.height&&(n=o[e].getAttribute("osrc"))&&(o[e].setAttribute("src",n),o[e].onerror=function(){(n=this.getAttribute("osrc-bak"))&&(this.setAttribute("src",n),this.onerror=null)},o[e].onload=function(){c++})}};window.addEventListener?t.addEventListener("scroll",l,!1):window.attachEvent&&window.attachEvent("onscroll",l),l(),s.promise()}),"function"!=typeof t.getElementsByClassName&&(t.getElementsByClassName=function(e){for(var n=t,o=n.getElementsByTagName("*"),r=new RegExp("\\b"+e+"\\b"),a=[],i=0,s=o.length;s>i;i++){var e=o[i].className;r.test(e)&&a.push(o[i])}return a});var l=function(e){var n=t.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(n)};s.then(function(){for(var e=t.getElementsByClassName("lazyCss"),n=0;n<e.length;n++)l(e[n].value||e[n].innerHTML);s.promise()}),s.then(function(){for(var e=t.getElementsByClassName("lazyHtml"),n=0;n<e.length;n++)if("TEXTAREA"==e[n].tagName){var o=t.createElement("DIV");o.innerHTML=e[n].value,e[n].parentNode.insertBefore(o,e[n])}s.promise()});var f={};f.deferred=s,f.createDeferred=i,f.loadJs=c,f.onload=!1,f.run=function(){f.onload=!0,s.promise(),c.start()},e.lml=f}(window,document);
